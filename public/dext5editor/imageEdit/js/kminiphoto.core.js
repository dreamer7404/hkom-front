(function(a,c){"object"===typeof exports&&"undefined"!==typeof module?module.exports=c():"function"===typeof define&&define.amd?define(c):a.Cropper=c()})(this,function(){function a(d){return"number"===typeof d&&!isNaN(d)}function c(d){return"undefined"===typeof d}function b(d){return"object"===("undefined"===typeof d?"undefined":ka(d))&&null!==d}function e(d){if(!b(d))return!1;try{var g=d.constructor,m=g.prototype;return g&&m&&la.call(m,"isPrototypeOf")}catch(a){return!1}}function h(d){return"function"===
V.call(d).slice(8,-1).toLowerCase()}function r(d){return Array.isArray?Array.isArray(d):"array"===V.call(d).slice(8,-1).toLowerCase()}function t(d){"string"===typeof d&&(d=d.trim?d.trim():d.replace(ma,"$1"));return d}function p(d,g){if(d&&h(g)){var m=void 0;if(r(d)||a(d.length))for(var c=d.length,m=0;m<c&&!1!==g.call(d,d[m],m,d);m+=1);else b(d)&&Object.keys(d).forEach(function(m){g.call(d,d[m],m,d)})}return d}function q(d){for(var g=arguments.length,m=Array(1<g?g-1:0),a=1;a<g;a++)m[a-1]=arguments[a];
if(b(d)&&0<m.length){if(Object.assign)return Object.assign.apply(Object,[d].concat(m));m.forEach(function(g){b(g)&&Object.keys(g).forEach(function(m){d[m]=g[m]})})}return d}function I(d,g){for(var m=arguments.length,a=Array(2<m?m-2:0),c=2;c<m;c++)a[c-2]=arguments[c];return function(){for(var m=arguments.length,c=Array(m),b=0;b<m;b++)c[b]=arguments[b];return d.apply(g,a.concat(c))}}function J(d,g){var m=d.style;p(g,function(d,g){na.test(g)&&a(d)&&(d+="px");m[g]=d})}function oa(d,g){return d.classList?
d.classList.contains(g):-1<d.className.indexOf(g)}function A(d,g){if(g)if(a(d.length))p(d,function(d){A(d,g)});else if(d.classList)d.classList.add(g);else{var m=t(d.className);m?0>m.indexOf(g)&&(d.className=m+" "+g):d.className=g}}function G(d,g){g&&(a(d.length)?p(d,function(d){G(d,g)}):d.classList?d.classList.remove(g):0<=d.className.indexOf(g)&&(d.className=d.className.replace(g,"")))}function L(d,g,m){g&&(a(d.length)?p(d,function(d){L(d,g,m)}):m?A(d,g):G(d,g))}function T(d){return d.replace(pa,
"$1-$2").toLowerCase()}function P(d,g){return b(d[g])?d[g]:d.dataset?d.dataset[g]:d.getAttribute("data-"+T(g))}function M(d,g,m){b(m)?d[g]=m:d.dataset?d.dataset[g]=m:d.setAttribute("data-"+T(g),m)}function W(d,g){if(b(d[g]))delete d[g];else if(d.dataset)try{delete d.dataset[g]}catch(m){d.dataset[g]=null}else d.removeAttribute("data-"+T(g))}function z(d,g,m){var a=t(g).split(X);1<a.length?p(a,function(g){z(d,g,m)}):d.removeEventListener?d.removeEventListener(g,m,!1):d.detachEvent&&d.detachEvent("on"+
g,m)}function D(d,g,m,a){var c=t(g).split(X),b=m;1<c.length?p(c,function(g){D(d,g,m)}):(a&&(m=function(){for(var a=arguments.length,c=Array(a),O=0;O<a;O++)c[O]=arguments[O];z(d,g,m);return b.apply(d,c)}),d.addEventListener?d.addEventListener(g,m,!1):d.attachEvent&&d.attachEvent("on"+g,m))}function K(d,g,m){if(d.dispatchEvent){var a=void 0;h(Event)&&h(CustomEvent)?a=c(m)?new Event(g,{bubbles:!0,cancelable:!0}):new CustomEvent(g,{detail:m,bubbles:!0,cancelable:!0}):c(m)?(a=document.createEvent("Event"),
a.initEvent(g,!0,!0)):(a=document.createEvent("CustomEvent"),a.initCustomEvent(g,!0,!0,m));return d.dispatchEvent(a)}return d.fireEvent?d.fireEvent("on"+g):!0}function Q(d){var g=d||window.event;g.target||(g.target=g.srcElement||document);if(!a(g.pageX)&&a(g.clientX)){var m=d.target.ownerDocument||document;d=m.documentElement;m=m.body;g.pageX=g.clientX+((d&&d.scrollLeft||m&&m.scrollLeft||0)-(d&&d.clientLeft||m&&m.clientLeft||0));g.pageY=g.clientY+((d&&d.scrollTop||m&&m.scrollTop||0)-(d&&d.clientTop||
m&&m.clientTop||0))}return g}function Y(d){var g=document.documentElement;d=d.getBoundingClientRect();return{left:d.left+((window.scrollX||g&&g.scrollLeft||0)-(g&&g.clientLeft||0)),top:d.top+((window.scrollY||g&&g.scrollTop||0)-(g&&g.clientTop||0))}}function H(d,g){return d.getElementsByClassName?d.getElementsByClassName(g):d.querySelectorAll("."+g)}function U(d){d.parentNode&&d.parentNode.removeChild(d)}function Z(d){return(d=d.match(qa))&&(d[1]!==location.protocol||d[2]!==location.hostname||d[3]!==
location.port)}function aa(d){var g="timestamp="+(new Date).getTime();return d+(-1===d.indexOf("?")?"?":"&")+g}function ra(d,g){if(d.naturalWidth&&!ba)g(d.naturalWidth,d.naturalHeight);else{var m=document.createElement("img");m.onload=function(){g(this.width,this.height)};m.src=d.src}}function N(d){var g=[],m=d.translateX,c=d.translateY,b=d.rotate,k=d.scaleX;d=d.scaleY;a(m)&&0!==m&&g.push("translateX("+m+"px)");a(c)&&0!==c&&g.push("translateY("+c+"px)");a(b)&&0!==b&&g.push("rotate("+b+"deg)");a(k)&&
1!==k&&g.push("scaleX("+k+")");a(d)&&1!==d&&g.push("scaleY("+d+")");g=g.length?g.join(" "):"none";return{WebkitTransform:g,msTransform:g,transform:g}}function R(d,g){var m=Math.abs(d.degree)%180,a=(90<m?180-m:m)*Math.PI/180,m=Math.sin(a),a=Math.cos(a),c=d.width,b=d.height,f=d.aspectRatio,l=void 0,e=void 0;g?(l=c/(a+m/f),e=l/f):(l=c*a+b*m,e=c*m+b*a);return{width:l,height:e}}function ca(d,g,m){var c=document.createElement("canvas"),b=c.getContext("2d"),k=0,f=0,l=g.naturalWidth,e=g.naturalHeight,n=g.rotate,
h=g.scaleX;g=g.scaleY;var p=a(h)&&a(g)&&(1!==h||1!==g),q=a(n)&&0!==n,E=q||p,y=l*Math.abs(h||1),C=e*Math.abs(g||1),B=void 0,u=void 0,r=void 0;p&&(B=y/2,u=C/2);q&&(r=R({width:y,height:C,degree:n}),y=r.width,C=r.height,B=y/2,u=C/2);c.width=y;c.height=C;m.fillColor&&(b.fillStyle=m.fillColor,b.fillRect(0,0,y,C));E&&(k=-l/2,f=-e/2,b.save(),b.translate(B,u));q&&b.rotate(n*Math.PI/180);p&&b.scale(h,g);b.imageSmoothingEnabled=!!m.imageSmoothingEnabled;m.imageSmoothingQuality&&(b.imageSmoothingQuality=m.imageSmoothingQuality);
b.drawImage(d,Math.floor(k),Math.floor(f),Math.floor(l),Math.floor(e));E&&b.restore();return c}function sa(d){d=d.replace(ta,"");d=atob(d);for(var g=d.length,m=new ArrayBuffer(g),a=new Uint8Array(m),c=void 0,c=0;c<g;c+=1)a[c]=d.charCodeAt(c);return m}function S(d,g){var m=d.pageX,a=d.pageY,c={endX:m,endY:a};return g?c:q({startX:m,startY:a},c)}function ua(d){var g=q({},d),m=[];p(d,function(d,a){delete g[a];p(g,function(g){var a=Math.abs(d.startX-g.startX),c=Math.abs(d.startY-g.startY),b=Math.abs(d.endX-
g.endX);g=Math.abs(d.endY-g.endY);a=Math.sqrt(a*a+c*c);b=(Math.sqrt(b*b+g*g)-a)/a;m.push(b)})});m.sort(function(d,g){return Math.abs(d)<Math.abs(g)});return m[0]}function va(d){if(Array.isArray(d)){for(var g=0,a=Array(d.length);g<d.length;g++)a[g]=d[g];return a}return Array.from(d)}function wa(d){var g=0,a=0,c=0;p(d,function(d){var b=d.startY;g+=d.startX;a+=b;c+=1});g/=c;a/=c;return{pageX:g,pageY:a}}var da={viewMode:0,dragMode:"crop",aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,
checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!1,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:1,minContainerHeight:1,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},ka="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?
function(d){return typeof d}:function(d){return d&&"function"===typeof Symbol&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},ta=/^data:.*,/,pa=/([a-z\d])([A-Z])/g,qa=/^(https?:)\/\/([^:/?#]+):?(\d*)/i,X=/\s+/,na=/^(width|height|left|top|marginLeft|marginTop)$/,ma=/^\s+(.*)\s+$/,F=/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i,ea="undefined"!==typeof window?window.navigator:null,ba=ea&&F.test(ea.userAgent),F=Object.prototype,V=F.toString,la=F.hasOwnProperty,fa=String.fromCharCode,ga=
(F="undefined"!==typeof window?window.PointerEvent:null)?"pointerdown":"touchstart mousedown",ha=F?"pointermove":"touchmove mousemove",ia=F?" pointerup pointercancel":"touchend touchcancel mouseup",xa=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,ya=function(){function d(d,a){for(var c=0;c<a.length;c++){var b=a[c];b.enumerable=b.enumerable||!1;b.configurable=!0;"value"in b&&(b.writable=!0);Object.defineProperty(d,b.key,b)}}return function(g,a,c){a&&d(g.prototype,a);c&&d(g,c);return g}}(),za=/^data:/,
Aa=/^data:image\/jpeg;base64,/,ja=void 0,F=function(){function d(g,a){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");this.element=g;this.options=q({},da,e(a)&&a);this.isImg=this.wheeling=this.limited=this.replaced=this.disabled=this.cropped=this.rotated=this.complete=this.ready=this.loaded=!1;this.originalUrl="";this.previews=this.cropBoxData=this.canvasData=null;this.pointers={};this.init()}ya(d,[{key:"init",value:function(){var d=this.element,a=d.tagName.toLowerCase(),
c=void 0;if(!P(d,"cropper")){M(d,"cropper",this);if("img"===a){this.isImg=!0;this.originalUrl=c=d.getAttribute("src");if(!c)return;c=d.src}else"canvas"===a&&window.HTMLCanvasElement&&(c=d.toDataURL("image/"+KMINIPHOTOTOP.G_CURRKMINIPHOTO.initImgExt,1));this.load(c)}}},{key:"load",value:function(d){var a=this,c=a.options,b=a.element;if(d)if(a.url=d,a.imageData={},c.checkOrientation&&window.ArrayBuffer)if(za.test(d))Aa.test(d)?a.read(sa(d)):a.clone();else{var k=new XMLHttpRequest;k.onerror=function(){a.clone()};
k.onload=function(){a.read(k.response)};c.checkCrossOrigin&&Z(d)&&b.crossOrigin&&(d=aa(d));k.open("get",d);k.responseType="arraybuffer";k.withCredentials="use-credentials"===b.crossOrigin;k.send()}else a.clone()}},{key:"read",value:function(d){var a=this.options,c;c=new DataView(d);var b=c.byteLength,k=void 0,f=void 0,l=void 0,e=f=void 0,n=l=f=void 0,h=f=void 0;if(255===c.getUint8(0)&&216===c.getUint8(1))for(f=2;f<b;){if(255===c.getUint8(f)&&225===c.getUint8(f+1)){l=f;break}f+=1}if(l){f=l+4;l+=10;
b="";h=f;for(f=4+f;h<f;h+=1)b+=fa(c.getUint8(h));"Exif"===b&&(f=c.getUint16(l),!(e=18761===f)&&19789!==f||42!==c.getUint16(l+2,e)||(f=c.getUint32(l+4,e),8<=f&&(n=l+f)))}if(n)for(b=c.getUint16(n,e),h=0;h<b;h+=1)if(f=n+12*h+2,274===c.getUint16(f,e)){f+=8;k=c.getUint16(f,e);ba&&c.setUint16(f,1,e);break}c=k;k=this.imageData;e=0;b=n=1;if(1<c){d=new Uint8Array(d);l=d.length;f="";h=void 0;for(h=0;h<l;h+=1)f+=fa(d[h]);this.url="data:image/jpeg;base64,"+btoa(f);switch(c){case 2:n=-1;break;case 3:e=-180;break;
case 4:b=-1;break;case 5:e=90;b=-1;break;case 6:e=90;break;case 7:e=90;n=-1;break;case 8:e=-90}}a.rotatable&&(k.rotate=e);a.scalable&&(k.scaleX=n,k.scaleY=b);this.clone()}},{key:"clone",value:function(){var d=this.element,a=this.url,c=void 0,b=void 0;this.options.checkCrossOrigin&&Z(a)&&((c=d.crossOrigin)?b=a:(c="anonymous",b=aa(a)));this.crossOrigin=c;this.crossOriginUrl=b;var k=document.createElement("img");c&&(k.crossOrigin=c);k.src=b||a;a=I(this.start,this);c=I(this.stop,this);this.image=k;this.onStart=
a;this.onStop=c;this.isImg?d.complete?this.start():D(d,"load",a):(D(k,"load",a),D(k,"error",c),A(k,"cropper-hide"),d.parentNode.insertBefore(k,d.nextSibling))}},{key:"start",value:function(d){var a=this,c=a.isImg?a.element:a.image;d&&(z(c,"load",a.onStart),z(c,"error",a.onStop));ra(c,function(d,g){q(a.imageData,{naturalWidth:d,naturalHeight:g,aspectRatio:d/g});a.loaded=!0;a.build()})}},{key:"stop",value:function(){var d=this.image;z(d,"load",this.onStart);z(d,"error",this.onStop);U(d);this.image=
null}},{key:"build",value:function(){var d=this,a=d.options,c=d.element,b=d.image;if(d.loaded){d.ready&&d.unbuild();var k=c.parentNode,f=document.createElement("div");f.innerHTML='<div class="cropper-container"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>';
var f=H(f,"cropper-container")[0],l=H(f,"cropper-canvas")[0],e=H(f,"cropper-drag-box")[0],n=H(f,"cropper-crop-box")[0],p=H(n,"cropper-face")[0];d.container=k;d.cropper=f;d.canvas=l;d.dragBox=e;d.cropBox=n;d.viewBox=H(f,"cropper-view-box")[0];d.face=p;l.appendChild(b);A(c,"cropper-hidden");k.insertBefore(f,c.nextSibling);d.isImg||G(b,"cropper-hide");d.initPreview();d.bind();a.aspectRatio=Math.max(0,a.aspectRatio)||NaN;a.viewMode=Math.max(0,Math.min(3,Math.round(a.viewMode)))||0;(d.cropped=a.autoCrop)?
a.modal&&A(e,"cropper-modal"):A(n,"cropper-hidden");a.guides||A(H(n,"cropper-dashed"),"cropper-hidden");a.center||A(H(n,"cropper-center"),"cropper-hidden");a.background&&A(f,"cropper-bg");a.highlight||A(p,"cropper-invisible");a.cropBoxMovable&&(A(p,"cropper-move"),M(p,"action","all"));a.cropBoxResizable||(A(H(n,"cropper-line"),"cropper-hidden"),A(H(n,"cropper-point"),"cropper-hidden"));d.setDragMode(a.dragMode);d.render();d.ready=!0;d.setData(a.data);d.completing=setTimeout(function(){h(a.ready)&&
D(c,"ready",a.ready,!0);K(c,"ready");K(c,"crop",d.getData());d.complete=!0},0)}}},{key:"unbuild",value:function(){this.ready&&(this.complete||clearTimeout(this.completing),this.complete=this.ready=!1,this.cropBoxData=this.canvasData=this.containerData=this.initialCropBoxData=this.initialCanvasData=this.initialImageData=null,this.unbind(),this.resetPreview(),this.container=this.canvas=this.dragBox=this.cropBox=this.viewBox=this.previews=null,U(this.cropper),this.cropper=null)}}],[{key:"noConflict",
value:function(){window.Cropper=ja;return d}},{key:"setDefaults",value:function(d){q(da,e(d)&&d)}}]);return d}();q(F.prototype,{render:function(){this.initContainer();this.initCanvas();this.initCropBox();this.renderCanvas();this.cropped&&this.renderCropBox()},initContainer:function(){var d=this.options,a=this.element,c=this.container,b=this.cropper;A(b,"cropper-hidden");G(a,"cropper-hidden");this.containerData=d={width:Math.max(c.offsetWidth,Number(d.minContainerWidth)||200),height:Math.max(c.offsetHeight,
Number(d.minContainerHeight)||100)};J(b,{width:d.width,height:d.height});A(a,"cropper-hidden");G(b,"cropper-hidden")},initCanvas:function(){var d=this.options.viewMode,a=this.containerData,c=this.imageData,b=90===Math.abs(c.rotate)%180,v=b?c.naturalHeight:c.naturalWidth,k=b?c.naturalWidth:c.naturalHeight,f=v/k,b=a.width,l=a.height;a.height*f>a.width?3===d?b=a.height*f:l=a.width/f:3===d?l=a.width/f:b=a.height*f;v={naturalWidth:v,naturalHeight:k,aspectRatio:f,width:b,height:l};v.left=(a.width-b)/2;
v.top=(a.height-l)/2;v.oldLeft=v.left;v.oldTop=v.top;this.canvasData=v;this.limited=1===d||2===d;this.limitCanvas(!0,!0);this.initialImageData=q({},c);this.initialCanvasData=q({},v)},limitCanvas:function(d,a){var c=this.options,b=c.viewMode,v=this.containerData,k=this.canvasData,f=k.aspectRatio,l=this.cropBoxData,e=this.cropped&&l;if(d){var n=Number(c.minCanvasWidth)||0,c=Number(c.minCanvasHeight)||0;1<b?(n=Math.max(n,v.width),c=Math.max(c,v.height),3===b&&(c*f>n?n=c*f:c=n/f)):0<b&&(n?n=Math.max(n,
e?l.width:0):c?c=Math.max(c,e?l.height:0):e&&(n=l.width,c=l.height,c*f>n?n=c*f:c=n/f));n&&c?c*f>n?c=n/f:n=c*f:n?c=n/f:c&&(n=c*f);k.minWidth=n;k.minHeight=c;k.maxWidth=Infinity;k.maxHeight=Infinity}a&&(b?(f=v.width-k.width,n=v.height-k.height,k.minLeft=Math.min(0,f),k.minTop=Math.min(0,n),k.maxLeft=Math.max(0,f),k.maxTop=Math.max(0,n),e&&this.limited&&(k.minLeft=Math.min(l.left,l.left+(l.width-k.width)),k.minTop=Math.min(l.top,l.top+(l.height-k.height)),k.maxLeft=l.left,k.maxTop=l.top,2===b&&(k.width>=
v.width&&(k.minLeft=Math.min(0,f),k.maxLeft=Math.max(0,f)),k.height>=v.height&&(k.minTop=Math.min(0,n),k.maxTop=Math.max(0,n))))):(k.minLeft=-k.width,k.minTop=-k.height,k.maxLeft=v.width,k.maxTop=v.height))},renderCanvas:function(d){var a=this.canvasData,c=this.imageData,b=c.rotate;if(this.rotated){this.rotated=!1;var e=R({width:c.width,height:c.height,degree:b}),k=e.width/e.height,f=1===c.aspectRatio;if(f||k!==a.aspectRatio){a.left-=(e.width-a.width)/2;a.top-=(e.height-a.height)/2;a.width=e.width;
a.height=e.height;a.aspectRatio=k;a.naturalWidth=c.naturalWidth;a.naturalHeight=c.naturalHeight;if(f&&b%90||b%180)c=R({width:c.naturalWidth,height:c.naturalHeight,degree:b}),a.naturalWidth=c.width,a.naturalHeight=c.height;this.limitCanvas(!0,!1)}}if(a.width>a.maxWidth||a.width<a.minWidth)a.left=a.oldLeft;if(a.height>a.maxHeight||a.height<a.minHeight)a.top=a.oldTop;a.width=Math.min(Math.max(a.width,a.minWidth),a.maxWidth);a.height=Math.min(Math.max(a.height,a.minHeight),a.maxHeight);this.limitCanvas(!1,
!0);a.left=Math.min(Math.max(a.left,a.minLeft),a.maxLeft);a.top=Math.min(Math.max(a.top,a.minTop),a.maxTop);a.oldLeft=a.left;a.oldTop=a.top;J(this.canvas,q({width:a.width,height:a.height},N({translateX:a.left,translateY:a.top})));this.renderImage();this.cropped&&this.limited&&this.limitCropBox(!0,!0);d&&this.output()},renderImage:function(d){var a=this.canvasData,c=this.imageData,b=void 0,e=void 0,k=void 0,e=void 0;c.rotate&&(e=R({width:a.width,height:a.height,degree:c.rotate,aspectRatio:c.aspectRatio},
!0),k=e.width,e=e.height,b={width:k,height:e,left:(a.width-k)/2,top:(a.height-e)/2});q(c,b||{width:a.width,height:a.height,left:0,top:0});J(this.image,q({width:c.width,height:c.height},N(q({translateX:c.left,translateY:c.top},c))));d&&this.output()},initCropBox:function(){var d=this.options,a=d.aspectRatio,d=Number(d.autoCropArea)||.8,c=this.canvasData,b={width:c.width,height:c.height};a&&(c.height*a>c.width?b.height=b.width/a:b.width=b.height*a);this.cropBoxData=b;this.limitCropBox(!0,!0);b.width=
Math.min(Math.max(b.width,b.minWidth),b.maxWidth);b.height=Math.min(Math.max(b.height,b.minHeight),b.maxHeight);b.width=Math.max(b.minWidth,b.width*d);b.height=Math.max(b.minHeight,b.height*d);b.left=c.left+(c.width-b.width)/2;b.top=c.top+(c.height-b.height)/2;b.oldLeft=b.left;b.oldTop=b.top;this.initialCropBoxData=q({},b)},limitCropBox:function(a,c){var b=this.options,e=b.aspectRatio,v=this.containerData,k=this.canvasData,f=this.cropBoxData,l=this.limited;if(a){var h=Number(b.minCropBoxWidth)||0,
b=Number(b.minCropBoxHeight)||0,n=Math.min(v.width,l?k.width:v.width),p=Math.min(v.height,l?k.height:v.height),h=Math.min(h,v.width),b=Math.min(b,v.height);e&&(h&&b?b*e>h?b=h/e:h=b*e:h?b=h/e:b&&(h=b*e),p*e>n?p=n/e:n=p*e);f.minWidth=Math.min(h,n);f.minHeight=Math.min(b,p);f.maxWidth=n;f.maxHeight=p}c&&(l?(f.minLeft=Math.max(0,k.left),f.minTop=Math.max(0,k.top),f.maxLeft=Math.min(v.width,k.left+k.width)-f.width,f.maxTop=Math.min(v.height,k.top+k.height)-f.height):(f.minLeft=0,f.minTop=0,f.maxLeft=v.width-
f.width,f.maxTop=v.height-f.height))},renderCropBox:function(){var a=this.options,c=this.containerData,b=this.cropBoxData;if(b.width>b.maxWidth||b.width<b.minWidth)b.left=b.oldLeft;if(b.height>b.maxHeight||b.height<b.minHeight)b.top=b.oldTop;b.width=Math.min(Math.max(b.width,b.minWidth),b.maxWidth);b.height=Math.min(Math.max(b.height,b.minHeight),b.maxHeight);this.limitCropBox(!1,!0);b.left=Math.min(Math.max(b.left,b.minLeft),b.maxLeft);b.top=Math.min(Math.max(b.top,b.minTop),b.maxTop);b.oldLeft=
b.left;b.oldTop=b.top;a.movable&&a.cropBoxMovable&&M(this.face,"action",b.width===c.width&&b.height===c.height?"move":"all");J(this.cropBox,q({width:b.width,height:b.height},N({translateX:b.left,translateY:b.top})));this.cropped&&this.limited&&this.limitCanvas(!0,!0);this.disabled||this.output()},output:function(){this.preview();this.complete&&K(this.element,"crop",this.getData())}});q(F.prototype,{initPreview:function(){var a=this.options.preview,c=document.createElement("img"),b=this.crossOrigin,
e=b?this.crossOriginUrl:this.url;b&&(c.crossOrigin=b);c.src=e;this.viewBox.appendChild(c);this.image2=c;a&&(this.previews=a=a.querySelector?[a]:document.querySelectorAll(a),p(a,function(a){var d=document.createElement("img");M(a,"preview",{width:a.offsetWidth,height:a.offsetHeight,html:a.innerHTML});b&&(d.crossOrigin=b);d.src=e;for(d.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"';a.firstChild;)a.removeChild(a.firstChild);
a.appendChild(d)}))},resetPreview:function(){p(this.previews,function(a){var c=P(a,"preview");J(a,{width:c.width,height:c.height});a.innerHTML=c.html;W(a,"preview")})},preview:function(){var a=this.imageData,c=this.canvasData,b=this.cropBoxData,e=b.width,h=b.height,k=a.width,f=a.height,l=b.left-c.left-a.left,x=b.top-c.top-a.top;this.cropped&&!this.disabled&&(J(this.image2,q({width:k,height:f},N(q({translateX:-l,translateY:-x},a)))),p(this.previews,function(c){var b=P(c,"preview"),g=b.width,b=b.height,
m=g,p=b,y=1;e&&(y=g/e,p=h*y);h&&p>b&&(y=b/h,m=e*y,p=b);J(c,{width:m,height:p});J(c.getElementsByTagName("img")[0],q({width:k*y,height:f*y},N(q({translateX:-l*y,translateY:-x*y},a))))}))}});q(F.prototype,{bind:function(){var a=this.options,c=this.element,b=this.cropper;h(a.cropstart)&&D(c,"cropstart",a.cropstart);h(a.cropmove)&&D(c,"cropmove",a.cropmove);h(a.cropend)&&D(c,"cropend",a.cropend);h(a.crop)&&D(c,"crop",a.crop);h(a.zoom)&&D(c,"zoom",a.zoom);D(b,ga,this.onCropStart=I(this.cropStart,this));
a.zoomable&&a.zoomOnWheel&&D(b,"wheel mousewheel DOMMouseScroll",this.onWheel=I(this.wheel,this));a.toggleDragModeOnDblclick&&D(b,"dblclick",this.onDblclick=I(this.dblclick,this));D(document,ha,this.onCropMove=I(this.cropMove,this));D(document,ia,this.onCropEnd=I(this.cropEnd,this));a.responsive&&D(window,"resize",this.onResize=I(this.resize,this))},unbind:function(){var a=this.options,c=this.element,b=this.cropper;h(a.cropstart)&&z(c,"cropstart",a.cropstart);h(a.cropmove)&&z(c,"cropmove",a.cropmove);
h(a.cropend)&&z(c,"cropend",a.cropend);h(a.crop)&&z(c,"crop",a.crop);h(a.zoom)&&z(c,"zoom",a.zoom);z(b,ga,this.onCropStart);a.zoomable&&a.zoomOnWheel&&z(b,"wheel mousewheel DOMMouseScroll",this.onWheel);a.toggleDragModeOnDblclick&&z(b,"dblclick",this.onDblclick);z(document,ha,this.onCropMove);z(document,ia,this.onCropEnd);a.responsive&&z(window,"resize",this.onResize)}});q(F.prototype,{resize:function(){var a=this.options,c=this.container,b=this.containerData,e=Number(a.minContainerWidth)||200,h=
Number(a.minContainerHeight)||100;if(!this.disabled&&b.width!==e&&b.height!==h){var k=c.offsetWidth/b.width;if(1!==k||c.offsetHeight!==b.height){var f=void 0,l=void 0;a.restore&&(f=this.getCanvasData(),l=this.getCropBoxData());this.render();a.restore&&(this.setCanvasData(p(f,function(a,c){f[c]=a*k})),this.setCropBoxData(p(l,function(a,c){l[c]=a*k})))}}},dblclick:function(){this.disabled||"none"===this.options.dragMode||this.setDragMode(oa(this.dragBox,"cropper-crop")?"move":"crop")},wheel:function(a){var c=
this;a=Q(a);var b=Number(c.options.wheelZoomRatio)||.1,e=1;c.disabled||(a.preventDefault(),c.wheeling||(c.wheeling=!0,setTimeout(function(){c.wheeling=!1},50),a.deltaY?e=0<a.deltaY?1:-1:a.wheelDelta?e=-a.wheelDelta/120:a.detail&&(e=0<a.detail?1:-1),c.zoom(-e*b,a)))},cropStart:function(a){if(!this.disabled){var c=this.options,b=this.pointers;a=Q(a);var e=void 0;a.changedTouches?p(a.changedTouches,function(a){b[a.identifier]=S(a)}):b[a.pointerId||0]=S(a);e=1<Object.keys(b).length&&c.zoomable&&c.zoomOnTouch?
"zoom":P(a.target,"action");xa.test(e)&&!1!==K(this.element,"cropstart",{originalEvent:a,action:e})&&(a.preventDefault(),this.action=e,this.cropping=!1,"crop"===e&&(p(b,function(a){a.startX=changeValueForZoom(a.startX,KMINIPHOTOTOP.G_CURRKMINIPHOTO);a.startY=changeValueForZoom(a.startY,KMINIPHOTOTOP.G_CURRKMINIPHOTO);a.endX=changeValueForZoom(a.endX,KMINIPHOTOTOP.G_CURRKMINIPHOTO);a.endY=changeValueForZoom(a.endY,KMINIPHOTOTOP.G_CURRKMINIPHOTO)}),this.cropping=!0,A(this.dragBox,"cropper-modal")))}},
cropMove:function(a){var c=this.action;if(!this.disabled&&c){var b=this.pointers;a=Q(a);a.preventDefault();!1!==K(this.element,"cropmove",{originalEvent:a,action:c})&&(a.changedTouches?p(a.changedTouches,function(a){q(b[a.identifier],S(a,!0))}):q(b[a.pointerId||0],S(a,!0)),this.change(a))}},cropEnd:function(a){if(!this.disabled){var c=this.action,b=this.pointers;a=Q(a);a.changedTouches?p(a.changedTouches,function(a){delete b[a.identifier]}):delete b[a.pointerId||0];c&&(a.preventDefault(),Object.keys(b).length||
(this.action=""),this.cropping&&(this.cropping=!1,L(this.dragBox,"cropper-modal",this.cropped&&this.options.modal)),K(this.element,"cropend",{originalEvent:a,action:c}))}}});q(F.prototype,{change:function(a){var c=this.containerData,b=this.canvasData,e=this.cropBoxData,h=this.options.aspectRatio,k=this.action,f=e.width,l=e.height,x=e.left,n=e.top,q=x+f,r=n+l,t=0,E=0,y=c.width,C=c.height,B=!0,u=void 0;!h&&a.shiftKey&&(h=f&&l?f/l:1);this.limited&&(t=e.minLeft,E=e.minTop,y=t+Math.min(c.width,b.width,
b.left+b.width),C=E+Math.min(c.height,b.height,b.top+b.height));var c=this.pointers,b=c[Object.keys(c)[0]],A=b.endX-b.startX,z=b.endY-b.startY,u=changeValueForZoom(A,KMINIPHOTOTOP.G_CURRKMINIPHOTO),w=changeValueForZoom(z,KMINIPHOTOTOP.G_CURRKMINIPHOTO);switch(k){case "all":x+=u;n+=w;break;case "e":if(0<=u&&(q>=y||h&&(n<=E||r>=C))){B=!1;break}q+u>y&&(u=y-q);f+=u;h&&(l=f/h,n-=u/h/2);0>f&&(k="w",f=0);break;case "n":if(0>=w&&(n<=E||h&&(x<=t||q>=y))){B=!1;break}n+w<E&&(w=E-n);l-=w;n+=w;h&&(f=l*h,x+=w*
h/2);0>l&&(k="s",l=0);break;case "w":if(0>=u&&(x<=t||h&&(n<=E||r>=C))){B=!1;break}x+u<t&&(u=t-x);f-=u;x+=u;h&&(l=f/h,n+=u/h/2);0>f&&(k="e",f=0);break;case "s":if(0<=w&&(r>=C||h&&(x<=t||q>=y))){B=!1;break}r+w>C&&(w=C-r);l+=w;h&&(f=l*h,x-=w*h/2);0>l&&(k="n",l=0);break;case "ne":if(h){if(0>=w&&(n<=E||q>=y)){B=!1;break}l-=w;n+=w;f=l*h}else 0<=u?q<y?f+=u:0>=w&&n<=E&&(B=!1):f+=u,0>=w?n>E&&(l-=w,n+=w):(l-=w,n+=w);0>f&&0>l?(k="sw",f=l=0):0>f?(k="nw",f=0):0>l&&(k="se",l=0);break;case "nw":if(h){if(0>=w&&(n<=
E||x<=t)){B=!1;break}l-=w;n+=w;f=l*h;x+=w*h}else 0>=u?x>t?(f-=u,x+=u):0>=w&&n<=E&&(B=!1):(f-=u,x+=u),0>=w?n>E&&(l-=w,n+=w):(l-=w,n+=w);0>f&&0>l?(k="se",f=l=0):0>f?(k="ne",f=0):0>l&&(k="sw",l=0);break;case "sw":if(h){if(0>=u&&(x<=t||r>=C)){B=!1;break}f-=u;x+=u;l=f/h}else 0>=u?x>t?(f-=u,x+=u):0<=w&&r>=C&&(B=!1):(f-=u,x+=u),0<=w?r<C&&(l+=w):l+=w;0>f&&0>l?(k="ne",f=l=0):0>f?(k="se",f=0):0>l&&(k="nw",l=0);break;case "se":if(h){if(0<=u&&(q>=y||r>=C)){B=!1;break}f+=u;l=f/h}else 0<=u?q<y?f+=u:0<=w&&r>=C&&
(B=!1):f+=u,0<=w?r<C&&(l+=w):l+=w;0>f&&0>l?(k="nw",f=l=0):0>f?(k="sw",f=0):0>l&&(k="ne",l=0);break;case "move":this.move(A,z);B=!1;break;case "zoom":this.zoom(ua(c),a);B=!1;break;case "crop":if(!A||!z){B=!1;break}u=Y(this.cropper);x=b.startX-u.left;n=b.startY-u.top;f=e.minWidth;l=e.minHeight;0<A?k=0<z?"se":"ne":0>A&&(x-=f,k=0<z?"sw":"nw");0>z&&(n-=l);this.cropped||(G(this.cropBox,"cropper-hidden"),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))}B&&(1!=getKMINIPHOTOWINoomValue(KMINIPHOTOTOP.G_CURRKMINIPHOTO)?
(e.width=parseFloat(f),e.height=parseFloat(l)):(e.width=parseInt(f,10),e.height=parseInt(l,10)),e.left=x,e.top=n,this.action=k,this.renderCropBox());p(c,function(a){a.startX=a.endX;a.startY=a.endY})}});q(F.prototype,{crop:function(){this.ready&&!this.disabled&&(this.cropped||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&A(this.dragBox,"cropper-modal"),G(this.cropBox,"cropper-hidden")),this.setCropBoxData(this.initialCropBoxData));return this},reset:function(){this.ready&&!this.disabled&&
(this.imageData=q({},this.initialImageData),this.canvasData=q({},this.initialCanvasData),this.cropBoxData=q({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox());return this},clear:function(){this.cropped&&!this.disabled&&(q(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),G(this.dragBox,"cropper-modal"),A(this.cropBox,"cropper-hidden"));return this},replace:function(a,c){!this.disabled&&
a&&(this.isImg&&(this.element.src=a),c?(this.url=a,this.image.src=a,this.ready&&(this.image2.src=a,p(this.previews,function(c){c.getElementsByTagName("img")[0].src=a}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.load(a)));return this},enable:function(){this.ready&&(this.disabled=!1,G(this.cropper,"cropper-disabled"));return this},disable:function(){this.ready&&(this.disabled=!0,A(this.cropper,"cropper-disabled"));return this},destroy:function(){var a=this.element,c=this.image;this.loaded?
(this.isImg&&this.replaced&&(a.src=this.originalUrl),this.unbuild(),G(a,"cropper-hidden")):this.isImg?z(a,"load",this.onStart):c&&U(c);W(a,"cropper");return this},move:function(a,b){var e=this.canvasData;return this.moveTo(c(a)?a:e.left+Number(a),c(b)?b:e.top+Number(b))},moveTo:function(b,g){var e=this.canvasData,h=!1;c(g)&&(g=b);b=Number(b);g=Number(g);this.ready&&!this.disabled&&this.options.movable&&(a(b)&&(e.left=b,h=!0),a(g)&&(e.top=g,h=!0),h&&this.renderCanvas(!0));return this},zoom:function(a,
c){var b=this.canvasData;a=Number(a);return this.zoomTo(b.width*(0>a?1/(1-a):1+a)/b.naturalWidth,c)},zoomTo:function(a,c){var b=this.options,e=this.canvasData,h=e.width,k=e.height,f=e.naturalWidth,l=e.naturalHeight;a=Number(a);if(0<=a&&this.ready&&!this.disabled&&b.zoomable){b=f*a;l*=a;if(!1===K(this.element,"zoom",{originalEvent:c,oldRatio:h/f,ratio:b/f}))return this;if(c){var p=this.pointers,f=Y(this.cropper),p=p&&Object.keys(p).length?wa(p):{pageX:c.pageX,pageY:c.pageY};e.left-=(p.pageX-f.left-
e.left)/h*(b-h);e.top-=(p.pageY-f.top-e.top)/k*(l-k)}else e.left-=(b-h)/2,e.top-=(l-k)/2;e.width=b;e.height=l;this.renderCanvas(!0)}return this},rotate:function(a){return this.rotateTo((this.imageData.rotate||0)+Number(a))},rotateTo:function(c){c=Number(c);a(c)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=c%360,this.rotated=!0,this.renderCanvas(!0));return this},scale:function(b,g){var e=this.imageData,h=!1;c(g)&&(g=b);b=Number(b);g=Number(g);this.ready&&!this.disabled&&
this.options.scalable&&(a(b)&&(e.scaleX=b,h=!0),a(g)&&(e.scaleY=g,h=!0),h&&this.renderImage(!0));return this},scaleX:function(c){var b=this.imageData.scaleY;return this.scale(c,a(b)?b:1)},scaleY:function(c){var b=this.imageData.scaleX;return this.scale(a(b)?b:1,c)},getData:function(a){var c=this.options,b=this.imageData,e=this.canvasData,h=this.cropBoxData,k=void 0,f=void 0;this.ready&&this.cropped?(f={x:h.left-e.left,y:h.top-e.top,width:h.width,height:h.height},k=b.width/b.naturalWidth,p(f,function(b,
c){b/=k;f[c]=a?Math.round(b):b})):f={x:0,y:0,width:0,height:0};c.rotatable&&(f.rotate=b.rotate||0);c.scalable&&(f.scaleX=b.scaleX||1,f.scaleY=b.scaleY||1);return f},setData:function(b){var c=this.options,m=this.imageData,p=this.canvasData,v={},k=void 0,f=void 0,l=void 0;h(b)&&(b=b.call(this.element));this.ready&&!this.disabled&&e(b)&&(c.rotatable&&a(b.rotate)&&b.rotate!==m.rotate&&(m.rotate=b.rotate,this.rotated=k=!0),c.scalable&&(a(b.scaleX)&&b.scaleX!==m.scaleX&&(m.scaleX=b.scaleX,f=!0),a(b.scaleY)&&
b.scaleY!==m.scaleY&&(m.scaleY=b.scaleY,f=!0)),k?this.renderCanvas():f&&this.renderImage(),l=m.width/m.naturalWidth,a(b.x)&&(v.left=b.x*l+p.left),a(b.y)&&(v.top=b.y*l+p.top),a(b.width)&&(v.width=b.width*l),a(b.height)&&(v.height=b.height*l),this.setCropBoxData(v));return this},getContainerData:function(){return this.ready?this.containerData:{}},getImageData:function(){return this.loaded?this.imageData:{}},getCanvasData:function(){var a=this.canvasData,b={};this.ready&&p("left top width height naturalWidth naturalHeight".split(" "),
function(c){b[c]=a[c]});return b},setCanvasData:function(b){var c=this.canvasData,m=c.aspectRatio;h(b)&&(b=b.call(this.element));this.ready&&!this.disabled&&e(b)&&(a(b.left)&&(c.left=b.left),a(b.top)&&(c.top=b.top),a(b.width)?(c.width=b.width,c.height=b.width/m):a(b.height)&&(c.height=b.height,c.width=b.height*m),this.renderCanvas(!0));return this},getCropBoxData:function(){var a=this.cropBoxData,b=void 0;this.ready&&this.cropped&&(b={left:a.left,top:a.top,width:a.width,height:a.height});return b||
{}},setCropBoxData:function(b){var c=this.cropBoxData,m=this.options.aspectRatio,p=void 0,v=void 0;h(b)&&(b=b.call(this.element));this.ready&&this.cropped&&!this.disabled&&e(b)&&(a(b.left)&&(c.left=b.left),a(b.top)&&(c.top=b.top),a(b.width)&&b.width!==c.width&&(p=!0,c.width=b.width),a(b.height)&&b.height!==c.height&&(v=!0,c.height=b.height),m&&(p?c.height=parseInt(c.width/m,10):v&&(c.width=parseInt(c.height*m,10))),this.renderCropBox());return this},getCroppedCanvas:function(a){if(!this.ready||!window.HTMLCanvasElement)return null;
e(a)||(a={});if(!this.cropped)return ca(this.image,this.imageData,a);var b=this.getData(),c=b.width,h=b.height,p=c/h,k=void 0,f=void 0,l=void 0;e(a)&&(k=a.width,f=a.height,k?(f=k/p,l=k/c):f&&(k=f*p,l=f/h));var k=Math.floor(k||c),q=Math.floor(f||h),f=document.createElement("canvas"),p=f.getContext("2d");f.width=k;f.height=q;a.fillColor&&(p.fillStyle=a.fillColor,p.fillRect(0,0,k,q));var n=ca(this.image,this.imageData,a),k=n.width,q=n.height,r=this.canvasData,n=[n],t=b.x+r.naturalWidth*(Math.abs(b.scaleX||
1)-1)/2,b=b.y+r.naturalHeight*(Math.abs(b.scaleY||1)-1)/2,A=r=void 0,z=void 0,y=void 0,C=void 0,B=void 0;t<=-c||t>k?C=z=r=t=0:0>=t?(z=-t,t=0,C=r=Math.min(k,c+t)):t<=k&&(z=0,C=r=Math.min(c,k-t));0>=r||b<=-h||b>q?B=y=A=b=0:0>=b?(y=-b,b=0,B=A=Math.min(q,h+b)):b<=q&&(y=0,B=A=Math.min(h,q-b));n.push(Math.floor(t),Math.floor(b),Math.floor(r),Math.floor(A));l&&(z*=l,y*=l,C*=l,B*=l);0<C&&0<B&&n.push(Math.floor(z),Math.floor(y),Math.floor(C),Math.floor(B));p.imageSmoothingEnabled=!!a.imageSmoothingEnabled;
a.imageSmoothingQuality&&(p.imageSmoothingQuality=a.imageSmoothingQuality);p.drawImage.apply(p,va(n));return f},setAspectRatio:function(a){var b=this.options;this.disabled||c(a)||(b.aspectRatio=Math.max(0,a)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox()));return this},setDragMode:function(a){var b=this.options,c=this.dragBox,e=this.face,h=void 0,k=void 0;this.loaded&&!this.disabled&&(h="crop"===a,k=b.movable&&"move"===a,a=h||k?a:"none",M(c,"action",a),L(c,"cropper-crop",
h),L(c,"cropper-move",k),b.cropBoxMovable||(M(e,"action",a),L(e,"cropper-crop",h),L(e,"cropper-move",k)));return this}});"undefined"!==typeof window&&(ja=window.Cropper,window.Cropper=F);return F});var KMINIPHOTOTOP=parent;setMiniPhotoWindow();setMiniPhotoDocument();KMINIPHOTOTOP.KMINIPHOTO=parent.KMINIPHOTO;parent.KMINIPHOTOTOP=KMINIPHOTOTOP;KMINIPHOTOTOP.KMINIPHOTO.util.overrideFn(window);Array.prototype.indexOf||(Array.prototype.indexOf=function(a,c){c=c||0;for(var b=this.length;c<b;){if(this[c]===a)return c;++c}return-1});String.prototype.insertAt||(String.prototype.insertAt=function(a,c){return this.substr(0,a)+c+this.substr(a)});
String.prototype.replaceAt||(String.prototype.replaceAt=function(a,c){return this.substr(0,a)+c+this.substr(a+c.length)});function setMiniPhotoWindow(){try{topURL=top.location.href,"undefined"==typeof topURL?(KMINIPHOTOTOP.KMINIPHOTOWIN=parent,KMINIPHOTOTOP.IsCrossDomain=!0):(KMINIPHOTOTOP.KMINIPHOTOWIN=parent,KMINIPHOTOTOP.IsCrossDomain=!1)}catch(a){KMINIPHOTOTOP.KMINIPHOTOWIN=parent,KMINIPHOTOTOP.IsCrossDomain=!0}}
function setMiniPhotoDocument(){try{topURL=top.location.href,"undefined"==typeof topURL?(KMINIPHOTOTOP.KMINIPHOTODOC=parent.document,KMINIPHOTOTOP.IsCrossDomain=!0):(KMINIPHOTOTOP.KMINIPHOTODOC=parent.document,KMINIPHOTOTOP.IsCrossDomain=!1)}catch(a){KMINIPHOTOTOP.KMINIPHOTODOC=parent.document,KMINIPHOTOTOP.IsCrossDomain=!0}}function raonk_frame_loaded_event(a,c,b){_raonk_miniphoto=new K_MiniPhoto(a,c,b);_raonk_miniphoto.start(c,_raonk_miniphoto)}
function K_MiniPhoto(a,c,b){this._config=c;this._frame=b;this.frameWin=window;this.ID=a;KMINIPHOTOTOP.KMINIPHOTO.RAONKMULTIPLE[b.frameID]=this;KMINIPHOTOTOP.G_CURRKMINIPHOTO=this;this.currDegree=0;this.flipY=this.flipX=!1;this.initImgHeight=this.initImgWidth=this.initImg=this.cropper=null;this.frameStatus=this.initImgExt="";this.arrBlobUrl=[];try{"function"===typeof KMINIPHOTOTOP.KMINIPHOTOWIN.KMINIPHOTO_OnLanguageDefinition&&KMINIPHOTOTOP.KMINIPHOTOWIN.KMINIPHOTO_OnLanguageDefinition(a,KMiniPhoto_Lang)}catch(e){}}
K_MiniPhoto.prototype={init:function(a){KMINIPHOTOTOP.KMINIPHOTO.util._setKMiniPhoto(a)},reset:function(a){KMINIPHOTOTOP.KMINIPHOTO.util._setKMiniPhoto(a)},start:function(a,c){var b=c._config;getDialogDocument();setZoomValueToBody(document,c);var e=parseInt(b.height);-1<b.height.indexOf("%")&&(e=KMINIPHOTOTOP.KMINIPHOTO.util.getClientRect(KMINIPHOTOTOP.KMINIPHOTODOC.getElementById("kminiphoto_holder_"+c.ID)),e=e.bottom-e.top);var h=parseInt(b.width);-1<b.width.indexOf("%")&&(h=KMINIPHOTOTOP.KMINIPHOTO.util.getClientRect(KMINIPHOTOTOP.KMINIPHOTODOC.getElementById("kminiphoto_holder_"+
c.ID)),h=h.right-h.left);getAreaSize(e,b,c);b=""+('<div id="miniPhoto_holder" class="wrap" style="width: '+(h-2)+'px;">')+'<div id="miniPhoto_header" class="miniPhoto_header">';b+="<h3></h3>";b+='<div class="btn-right">';b+='<a id="btn_fullscreen" href="javascript:;" class="K_mini_photo_maximization" title="'+KMiniPhoto_Lang.fullScreen+'"><span class="blind"></span></a><a href="javascript:;" class="K_mini_photo_close" title="'+KMiniPhoto_Lang.close+'"><span class="blind"></span></a>';b+="</div>";
b+="</div>";b+='<div class="miniPhoto_toolbar">';b+='<input id="open_file" type="file" accept=".jpg,.jpeg,.png,.gif,.bmp,.tiff,.tif" style="display:none;"/>';b+='<a id="btn_open" href="javascript:;" class="btn-function"><span class="img-open"></span><em>'+KMiniPhoto_Lang.open+"</em></a>";b+='<i class="vertical"></i>';b+='<a id="btn_undo" href="javascript:;" class="btn-do" title="'+KMiniPhoto_Lang.undo+'"><i class="undo deact-u"></i><p class="blind"></p></a>';b+='<a id="btn_redo" href="javascript:;" class="btn-do" title="'+
KMiniPhoto_Lang.redo+'"><i class="redo deact-r"></i><p class="blind"></p></a>';b+='<i class="vertical"></i>';b+='<a id="btn_crop" href="javascript:;" class="btn-function"><span class="img-crop"></span><em>'+KMiniPhoto_Lang.crop+"</em></a>";b+='<ul id="crop_tools_area" class="off">';b+='<li class="" title="Free"><a id="crop_ratio_0" href="javascript:;"><span class="img-ratio-free"></span><em>Free</em></a></li>';b+='<li class="" title="4:3"><a id="crop_ratio_1" href="javascript:;"><span class="img-ratio-4-3"></span><em>4:3</em></a></li>';
b+='<li class="" title="16:9"><a id="crop_ratio_2" href="javascript:;"><span class="img-ratio-16-9"></span><em>16:9</em></a></li>';b+='<li class="" title="1:1"><a id="crop_ratio_3" href="javascript:;"><span class="img-ratio-1-1"></span><em>1:1</em></a></li>';b+='<li class="" title="2:3"><a id="crop_ratio_4" href="javascript:;"><span class="img-ratio-2-3"></span><em>2:3</em></a></li>';b+='<li class="" title="3:4"><a id="crop_ratio_5" href="javascript:;"><span class="img-ratio-3-4"></span><em>3:4</em></a></li>';
b+='<li class="btnForCrop"><a id="crop_ok" href="javascript:;"><span class="btn-apply" title="'+KMiniPhoto_Lang.cropOk+'"></span><p class="blind"></p></a></li>';b+='<li class="btnForCrop"><a id="crop_cancel" href="javascript:;"><span class="btn-cancel" title="'+KMiniPhoto_Lang.cropCancel+'"></span><p class="blind"></p></a></li>';b+="</ul>";b+='<a id="img_rotate_l" href="javascript:;" class="btn-function" title="'+KMiniPhoto_Lang.rotate_l_detail+'"><span class="img-rotationL"></span><em>'+KMiniPhoto_Lang.rotate_l+
"</em></a>";b+='<a id="img_rotate_r" href="javascript:;" class="btn-function" title="'+KMiniPhoto_Lang.rotate_r_detail+'"><span class="img-rotationR"></span><em>'+KMiniPhoto_Lang.rotate_r+"</em></a>";b+='<a id="img_flip_h" href="javascript:;" class="btn-function" title="'+KMiniPhoto_Lang.flip_x_detail+'"><span class="img-flipV"></span><em>'+KMiniPhoto_Lang.flip_x+"</em></a>";b+='<a id="img_flip_v" href="javascript:;" class="btn-function" title="'+KMiniPhoto_Lang.flip_y_detail+'"><span class="img-flipH"></span><em>'+
KMiniPhoto_Lang.flip_y+"</em></a>";b+='<div class="buttonArea">';b+='<a id="btn_apply" href="javascript:;" class="btnApply" title="'+KMiniPhoto_Lang.apply+'"><span>'+KMiniPhoto_Lang.apply+'</span></a><a id="btn_reset" href="javascript:;" class="btnCancel" title="'+KMiniPhoto_Lang.reset+'"><span>'+KMiniPhoto_Lang.reset+"</span></a>";b+="</div>";b+="</div>";b+="<table>";b+="<tbody>";b+='<tr class="imageArea"><td><span id="span_processing" class="RAONK_photo_loading_img" style="display:none;">Processing...</span><div id="miniPhoto_image" style="height:'+
c.areaSize.imageAreaHeight+'px; border:0; overflow:auto;"><div style="position:relative; background-image:url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAAA3NCSVQICAjb4U/gAAAABlBMVEXMzMz////TjRV2AAAACXBIWXMAAArrAAAK6wGCiw1aAAAAHHRFWHRTb2Z0d2FyZQBBZG9iZSBGaXJld29ya3MgQ1M26LyyjAAAABFJREFUCJlj+M/AgBVhF/0PAH6/D/HkDxOGAAAAAElFTkSuQmCC\')"></div></div></td></tr>';b+='<tr class="sizeArea">';b+="<td>";b+='<div class="t-l" style="display:none;">';b+="<span>"+KMiniPhoto_Lang.current_size+
"</span>";b+='<em id="crop_box_size">0 x 0 px</em>';b+="</div>";b+='<div class="t-r">';b+='<span class="hhh">'+KMiniPhoto_Lang.original_size+"</span>";b+='<em id="original_size">0 x 0 px</em>';b+="</div>";b+="</td>";b+="</tr>";b+="</tbody>";b+="</table>";b+="</div>";b+="</div>";document.body.style.overflow="hidden";document.body.innerHTML=b;setPage(c)},_raonkCommands:function(a,c,b,e){G_LAST_CMD=c},_setLazyLoadFrame:function(a){"0"==KMINIPHOTOTOP.G_CURRKMINIPHOTO._config.hideContextMenu&&KMINIPHOTO_CONTEXT._create(a)}};
function setPage(a){KMINIPHOTOTOP.document.getElementById("kminiphoto_holder_header_"+a.ID).getElementsByTagName("h3")[0].innerHTML=KMiniPhoto_Lang.title;KMINIPHOTOTOP.document.getElementById("btn_fullscreen_"+a.ID).title=KMiniPhoto_Lang.fullScreen;KMINIPHOTOTOP.document.getElementById("btn_close_"+a.ID).title=KMiniPhoto_Lang.close;setImageArea();KMINIPHOTOTOP.KMINIPHOTO.util.addEvent(window,"resize",function(){setZoomValueToBody(document,a)});try{"function"===typeof a._config.creationCompleteEvent&&
a._config.creationCompleteEvent(a.ID)}catch(c){}}
function loadImage(a){null==a.src?(a.isInit&&setEvent(),displayOriginalSize()):(displayProcessing(!0),setTimeout(function(){var c=document.getElementById("miniPhoto_image").firstChild;c&&(c.style.width="0px",c.style.height="0px");c.innerHTML="";KMINIPHOTOTOP.G_CURRKMINIPHOTO.currImage=null;KMINIPHOTOTOP.G_CURRKMINIPHOTO.currImage=void 0;KMINIPHOTOTOP.G_CURRKMINIPHOTO.currDegree=0;var b=new Image;b.style.display="none";c.appendChild(b);var e=document.createElement("canvas");e.id="image_canvas";c.appendChild(e);
b.crossOrigin="anonymous";b.onerror=function(){alert("error load image");fn_close()};b.onload=function(){KMINIPHOTOTOP.G_CURRKMINIPHOTO.currDegree=0;KMINIPHOTOTOP.G_CURRKMINIPHOTO.flipX=!1;KMINIPHOTOTOP.G_CURRKMINIPHOTO.flipY=!1;KMINIPHOTOTOP.G_CURRKMINIPHOTO.currImage=b;var c,r,t=b.naturalWidth,p=b.naturalHeight;c=a.width&&""!=a.width?a.width:t;r=a.height&&""!=a.height?a.height:p;e.width=parseInt(c,10);e.height=parseInt(r,10);e.parentNode.style.width=e.width+"px";e.parentNode.style.height=e.height+
"px";e.getContext("2d").drawImage(b,0,0,t,p,0,0,e.width,e.height);b.style.display="none";setCanvasPostionCenter();a.isInit?(setEvent(),G_HISTORY.reset(),KMINIPHOTOTOP.G_CURRKMINIPHOTO.initImg=b,KMINIPHOTOTOP.G_CURRKMINIPHOTO.initImgWidth=a.width,KMINIPHOTOTOP.G_CURRKMINIPHOTO.initImgHeight=a.height,c=e.toDataURL("image/"+KMINIPHOTOTOP.G_CURRKMINIPHOTO.initImgExt,1),loadImage({src:c,isResized:!0})):a.isResized&&(KMINIPHOTOTOP.G_CURRKMINIPHOTO.initImg=b);a.isOpen&&(G_HISTORY.reset(),KMINIPHOTOTOP.G_CURRKMINIPHOTO.initImg=
b,KMINIPHOTOTOP.G_CURRKMINIPHOTO.initImgWidth=b.naturalWidth,KMINIPHOTOTOP.G_CURRKMINIPHOTO.initImgHeight=b.naturalHeight);displayProcessing(!1);try{b=void 0}catch(q){}};0==a.src.indexOf("blob")&&KMINIPHOTOTOP.G_CURRKMINIPHOTO.arrBlobUrl.push(a.src);c=document.getElementById("open_file");c.value="";KMINIPHOTOTOP.KMINIPHOTO.browser.ie&&10==KMINIPHOTOTOP.KMINIPHOTO.browser.ieVersion&&(c.type="text",c.type="file");b.src=a.src},50))}
function displayOriginalSize(){var a=document.getElementById("original_size"),c=document.getElementById("image_canvas");a.innerHTML=c?c.width+" x "+c.height+" px":"0 x 0 px"}function getDialogWindow(){var a=KMINIPHOTOTOP.window;null!=KMINIPHOTOTOP.G_CURRKMINIPHOTO.dialogWindow&&(a=KMINIPHOTOTOP.G_CURRKMINIPHOTO.dialogWindow);return a}
function getDialogDocument(){var a=KMINIPHOTOTOP.window.document;null!=KMINIPHOTOTOP.G_CURRKMINIPHOTO.dialogWindow&&(a=KMINIPHOTOTOP.G_CURRKMINIPHOTO.dialogWindow.document);return a}function getAreaSize(a,c,b){b.areaSize={headerHeight:30,toolHeight:56,imageAreaHeight:a-30-56-20-2,footerHeight:20}}
function setImageArea(){var a=KMINIPHOTOTOP.KMINIPHOTO.util.getClientRect(document.getElementById("miniPhoto_image").parentNode),a=a.right-a.left,c=document.getElementById("miniPhoto_image");c.style.width=a+"px";c.style.height=KMINIPHOTOTOP.G_CURRKMINIPHOTO.areaSize.imageAreaHeight+"px"}
function setCanvasPostionCenter(){var a=document.getElementById("image_canvas");if(a){var c=a.parentNode.parentNode,b;c.clientWidth?(b=c.clientWidth,c=c.clientHeight):(c=KMINIPHOTOTOP.KMINIPHOTO.util.getClientRect(c),b=c.width,c=c.height);c=Math.round(c/2-a.height/2);0>c&&(c=0);b=Math.round(b/2-a.width/2);0>b&&(b=0);a&&(a.parentNode.style.top=c+"px",a.parentNode.style.left=b+"px");displayOriginalSize()}}
function setEvent(){var a=document.getElementById("open_file");a.onchange=function(){var c=a.files[0];if(c){var b=KMINIPHOTOTOP.G_CURRKMINIPHOTO._config.maxImageFileSize;0<b&&c.size>b?(c=KMiniPhoto_Lang.msg.max_file_size,c=c.replace("{0}",KMINIPHOTOTOP.KMINIPHOTO.util.bytesToSize(b).toString),alert(c)):(b=getImageExtensionFromType(c.type),c=(window.URL||window.webkitURL||window).createObjectURL(c),KMINIPHOTOTOP.G_CURRKMINIPHOTO.initImgExt=b,loadImage({isInit:!1,isOpen:!0,src:c}))}};document.getElementById("btn_open").onclick=
function(){cropCancel();fileOpen()};document.getElementById("btn_undo").onclick=function(){if(null!=document.getElementById("image_canvas")){cropCancel();var a=document.getElementById("image_canvas");G_HISTORY.undo(a,a.getContext("2d"))}};document.getElementById("btn_redo").onclick=function(){if(null!=document.getElementById("image_canvas")){cropCancel();var a=document.getElementById("image_canvas");G_HISTORY.redo(a,a.getContext("2d"))}};document.getElementById("img_rotate_r").onclick=function(){fn_imageChange({degree:90,
flip:0})};document.getElementById("img_rotate_l").onclick=function(){fn_imageChange({degree:-90,flip:0})};document.getElementById("img_flip_h").onclick=function(){fn_imageChange({degree:0,flip:1})};document.getElementById("img_flip_v").onclick=function(){fn_imageChange({degree:0,flip:-1})};document.getElementById("btn_crop").onclick=function(){null!=document.getElementById("image_canvas")&&null==KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper&&(displayProcessing(!0),setTimeout(function(){var a=document.getElementById("image_canvas");
a.style.left=a.parentNode.style.left;a.style.top=a.parentNode.style.top;a.parentNode.style.width=a.width+"px";a.parentNode.style.height=a.height+"px";KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper=new Cropper(a,{zoomOnWheel:!1,autoCrop:!1,toggleDragModeOnDblclick:!1,ready:function(){document.getElementById("crop_tools_area").className="";document.getElementById("crop_box_size").parentNode.style.display="";selectCropType(0);displayProcessing(!1)},crop:function(a){a=a.detail;if(KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper)try{var c=
parseInt(a.width,10),h=parseInt(a.height,10);if(0==c){var r=KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper.getCropBoxData();"undefined"!=typeof r.width&&(c=r.width=1,KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper.setCropBoxData(r))}0==h&&(r=KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper.getCropBoxData(),"undefined"!=typeof r.height&&(h=r.height=1,KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper.setCropBoxData(r)));document.getElementById("crop_box_size").innerHTML=c+" x "+h+" px"}catch(t){}}})},50))};document.getElementById("crop_cancel").onclick=
function(){cropCancel()};document.getElementById("crop_ok").onclick=function(){cropOk()};document.getElementById("crop_ratio_0").onclick=function(){setCropBox(0);selectCropType(0)};document.getElementById("crop_ratio_1").onclick=function(){setCropBox(4/3);selectCropType(1)};document.getElementById("crop_ratio_2").onclick=function(){setCropBox(16/9);selectCropType(2)};document.getElementById("crop_ratio_3").onclick=function(){setCropBox(1);selectCropType(3)};document.getElementById("crop_ratio_4").onclick=
function(){setCropBox(2/3);selectCropType(4)};document.getElementById("crop_ratio_5").onclick=function(){setCropBox(.75);selectCropType(5)};document.getElementById("btn_reset").onclick=function(){fn_reset()};document.getElementById("btn_apply").onclick=function(){fn_apply()};KMINIPHOTOTOP.document.getElementById("btn_fullscreen_"+KMINIPHOTOTOP.G_CURRKMINIPHOTO.ID).onclick=function(){fn_fullscreen()};KMINIPHOTOTOP.document.getElementById("btn_close_"+KMINIPHOTOTOP.G_CURRKMINIPHOTO.ID).onclick=function(){fn_close()};
KMINIPHOTOTOP.KMINIPHOTO.util.addEvent(document,"keydown",document_keydown);KMINIPHOTOTOP.KMINIPHOTO.util.addEvent(document.body,"paste",fn_pasteEvt);KMINIPHOTOTOP.KMINIPHOTO.util.addEvent(document,"dragover",documentDragOver);KMINIPHOTOTOP.KMINIPHOTO.util.addEvent(document,"drop",insertDropImage);KMINIPHOTOTOP.KMINIPHOTO.util.addEvent(window,"unload",_kminiphotoiframe_Unload)}
function _kminiphotoiframe_Unload(a){try{var c=getPhotoFromUnloadEvent(a);if("1"==c._config.autoDestroy.use)try{KMINIPHOTOTOP.KMINIPHOTO.Destroy(c)}catch(b){}}catch(e){}}
function document_keydown(a){var c="which"in a?a.which:a.keyCode,b=a.ctrlKey;if(KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper&&0==b)if(37==c){KMINIPHOTOTOP.KMINIPHOTO.util.cancelEvent(a);var e=KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper.getCropBoxData();--e.left;KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper.setCropBoxData(e)}else 39==c?(KMINIPHOTOTOP.KMINIPHOTO.util.cancelEvent(a),e=KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper.getCropBoxData(),e.left+=1,KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper.setCropBoxData(e)):38==c?(KMINIPHOTOTOP.KMINIPHOTO.util.cancelEvent(a),
e=KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper.getCropBoxData(),--e.top,KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper.setCropBoxData(e)):40==c?(KMINIPHOTOTOP.KMINIPHOTO.util.cancelEvent(a),e=KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper.getCropBoxData(),e.top+=1,KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper.setCropBoxData(e)):27==c&&cropCancel();1==b&&(a.altKey||86!=c||(KMINIPHOTOTOP.KMINIPHOTO.browser.ie&&11<=KMINIPHOTOTOP.KMINIPHOTO.browser.ieVersion||KMINIPHOTOTOP.KMINIPHOTO.browser.gecko)&&fn_makePasteEvt(a))}
function fileOpen(){document.getElementById("open_file").click()}function setCropBox(a){KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper.options.aspectRatio=a;var c={};if(0!=a){var b=KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper.getCropBoxData();c.width=parseInt(b.height*a,10);c.height=parseInt(b.height,10)}KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper.setCropBoxData(c)}
function fn_imageChange(a){null!=document.getElementById("image_canvas")&&(displayProcessing(!0),setTimeout(function(){KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper&&cropCancel();var c=document.getElementById("image_canvas"),b=c.getContext("2d");G_HISTORY.saveState(c);b.setTransform(1,0,0,1,0,0);b.clearRect(0,0,c.width,c.height);fn_rotate(a.degree,c,b);fn_flip(a.flip,c,b);b.drawImage(KMINIPHOTOTOP.G_CURRKMINIPHOTO.currImage,0,0);setCanvasPostionCenter();displayProcessing(!1)},50))}
function fn_rotate(a,c,b){a&&(KMINIPHOTOTOP.G_CURRKMINIPHOTO.currDegree+=a,360==KMINIPHOTOTOP.G_CURRKMINIPHOTO.currDegree?KMINIPHOTOTOP.G_CURRKMINIPHOTO.currDegree=0:0>KMINIPHOTOTOP.G_CURRKMINIPHOTO.currDegree&&(KMINIPHOTOTOP.G_CURRKMINIPHOTO.currDegree=360+KMINIPHOTOTOP.G_CURRKMINIPHOTO.currDegree));switch(KMINIPHOTOTOP.G_CURRKMINIPHOTO.currDegree){case 90:c.width=KMINIPHOTOTOP.G_CURRKMINIPHOTO.currImage.naturalHeight;c.height=KMINIPHOTOTOP.G_CURRKMINIPHOTO.currImage.naturalWidth;c.parentNode.style.width=
c.width+"px";c.parentNode.style.height=c.height+"px";b.rotate(KMINIPHOTOTOP.G_CURRKMINIPHOTO.currDegree*Math.PI/180);b.translate(0,-c.width);break;case 180:c.width=KMINIPHOTOTOP.G_CURRKMINIPHOTO.currImage.naturalWidth;c.height=KMINIPHOTOTOP.G_CURRKMINIPHOTO.currImage.naturalHeight;c.parentNode.style.width=c.width+"px";c.parentNode.style.height=c.height+"px";b.rotate(KMINIPHOTOTOP.G_CURRKMINIPHOTO.currDegree*Math.PI/180);b.translate(-1*c.width,-1*c.height);break;case 270:c.width=KMINIPHOTOTOP.G_CURRKMINIPHOTO.currImage.naturalHeight;
c.height=KMINIPHOTOTOP.G_CURRKMINIPHOTO.currImage.naturalWidth;c.parentNode.style.width=c.width+"px";c.parentNode.style.height=c.height+"px";b.rotate(KMINIPHOTOTOP.G_CURRKMINIPHOTO.currDegree*Math.PI/180);b.translate(-1*c.height,0);break;case 0:c.width=KMINIPHOTOTOP.G_CURRKMINIPHOTO.currImage.naturalWidth,c.height=KMINIPHOTOTOP.G_CURRKMINIPHOTO.currImage.naturalHeight,c.parentNode.style.width=c.width+"px",c.parentNode.style.height=c.height+"px",b.translate(0,0)}}
function fn_flip(a,c,b){var e;e=KMINIPHOTOTOP.G_CURRKMINIPHOTO.currImage.naturalWidth;c=KMINIPHOTOTOP.G_CURRKMINIPHOTO.currImage.naturalHeight;1==a?90==KMINIPHOTOTOP.G_CURRKMINIPHOTO.currDegree||270==KMINIPHOTOTOP.G_CURRKMINIPHOTO.currDegree?KMINIPHOTOTOP.G_CURRKMINIPHOTO.flipY=KMINIPHOTOTOP.G_CURRKMINIPHOTO.flipY?!1:!0:KMINIPHOTOTOP.G_CURRKMINIPHOTO.flipX=KMINIPHOTOTOP.G_CURRKMINIPHOTO.flipX?!1:!0:-1==a&&(90==KMINIPHOTOTOP.G_CURRKMINIPHOTO.currDegree||270==KMINIPHOTOTOP.G_CURRKMINIPHOTO.currDegree?
KMINIPHOTOTOP.G_CURRKMINIPHOTO.flipX=KMINIPHOTOTOP.G_CURRKMINIPHOTO.flipX?!1:!0:KMINIPHOTOTOP.G_CURRKMINIPHOTO.flipY=KMINIPHOTOTOP.G_CURRKMINIPHOTO.flipY?!1:!0);a=KMINIPHOTOTOP.G_CURRKMINIPHOTO.flipX?-1*e:0;c=KMINIPHOTOTOP.G_CURRKMINIPHOTO.flipY?-1*c:0;b.scale(KMINIPHOTOTOP.G_CURRKMINIPHOTO.flipX?-1:1,KMINIPHOTOTOP.G_CURRKMINIPHOTO.flipY?-1:1);b.translate(a,c)}
function fn_reset(){null!=document.getElementById("image_canvas")&&(cropCancel(),G_HISTORY.reset(),loadImage({isInit:!1,src:KMINIPHOTOTOP.G_CURRKMINIPHOTO.initImg.src,width:KMINIPHOTOTOP.G_CURRKMINIPHOTO.initImgWidth,height:KMINIPHOTOTOP.G_CURRKMINIPHOTO.initImgHeight}))}
function fn_apply(){if(null!=document.getElementById("image_canvas")){cropCancel();var a={src:"",width:"",height:""},c=document.getElementById("image_canvas");a.src=c.toDataURL("image/"+KMINIPHOTOTOP.G_CURRKMINIPHOTO.initImgExt,1);a.width=c.width+"px";a.height=c.height+"px";fn_close();try{"function"===typeof KMINIPHOTOTOP.G_CURRKMINIPHOTO._config.saveCompleteEvent&&KMINIPHOTOTOP.G_CURRKMINIPHOTO._config.saveCompleteEvent(KMINIPHOTOTOP.G_CURRKMINIPHOTO.ID,a)}catch(b){}}}
function closeCropArea(){KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper=null;document.getElementById("image_canvas");document.getElementById("crop_tools_area").className="off";var a=document.getElementById("crop_box_size");a.innerHTML="0 x 0 px";a.parentNode.style.display="none"}function cropCancel(){KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper&&(KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper.destroy(),closeCropArea())}
function cropOk(){displayProcessing(!0);setTimeout(function(){G_HISTORY.saveState(document.getElementById("image_canvas"));var a=KMINIPHOTOTOP.G_CURRKMINIPHOTO.cropper.getCroppedCanvas();closeCropArea();a=a.toDataURL("image/"+KMINIPHOTOTOP.G_CURRKMINIPHOTO.initImgExt,1);loadImage({isInit:!1,src:a})},50)}function displayProcessing(a){document.getElementById("span_processing").style.display=a?"":"none"}var G_originScrollSize,G_originPhotoSize=[],G_originfull={},G_origianPopupPos=[],G_relativePos,G_isRelativePos;
function fn_close(){displayProcessing(!1);cropCancel();var a=KMINIPHOTOTOP.G_CURRKMINIPHOTO.arrBlobUrl.length;if(0<a)for(var c=0;c<a;c++)try{(window.URL||window.webkitURL||window).revokeObjectURL(KMINIPHOTOTOP.G_CURRKMINIPHOTO.arrBlobUrl[c])}catch(b){}if(a=document.getElementById("image_canvas"))c=a.getContext("2d"),c.setTransform(1,0,0,1,0,0),c.clearRect(0,0,a.width,a.height),a=a.parentNode,a.style.width="0px",a.style.height="0px",a.innerHTML="";G_HISTORY.reset();"fullscreen"==KMINIPHOTOTOP.G_CURRKMINIPHOTO.frameStatus&&
fullSreenToOriginalSize();KMINIPHOTOTOP.document.getElementById("kminiphoto_holder_"+KMINIPHOTOTOP.G_CURRKMINIPHOTO.ID).style.display="none";KMINIPHOTOTOP.document.getElementById("kminiphoto_holder_body_"+KMINIPHOTOTOP.G_CURRKMINIPHOTO.ID).style.display="none";(a=KMINIPHOTOTOP.document.getElementById("kminiphoto_popup_background"))&&KMINIPHOTOTOP.document.body.removeChild(a)}
function fn_fullscreen(){var a=KMINIPHOTOTOP.document.getElementById("kminiphoto_holder_"+KMINIPHOTOTOP.G_CURRKMINIPHOTO.ID),c=document.getElementById("miniPhoto_holder"),b=document.getElementById("miniPhoto_image");if(""==KMINIPHOTOTOP.G_CURRKMINIPHOTO.frameStatus){var e=KMINIPHOTOTOP.G_CURRKMINIPHOTO._config.dialogWindow?KMINIPHOTOTOP.G_CURRKMINIPHOTO._config.dialogWindow:KMINIPHOTOTOP.window;G_originScrollSize=getWindowScrollPos(e);G_originPhotoSize.push(a.style.width);G_originPhotoSize.push(a.style.height);
G_originfull.margin1=KMINIPHOTOTOP.document.documentElement.style.margin;G_originfull.padding1=KMINIPHOTOTOP.document.documentElement.style.padding;G_originfull.border1=KMINIPHOTOTOP.document.documentElement.style.border;G_originfull.height1=KMINIPHOTOTOP.document.documentElement.style.height;G_originfull.overflow1=KMINIPHOTOTOP.document.documentElement.style.overflow;"1"==KMINIPHOTOTOP.G_CURRKMINIPHOTO._config.fullscreenType&&(G_originfull.margin2=KMINIPHOTOTOP.document.body.style.margin,G_originfull.padding2=
KMINIPHOTOTOP.document.body.style.padding,G_originfull.border2=KMINIPHOTOTOP.document.body.style.border,G_originfull.height2=KMINIPHOTOTOP.document.body.style.height,G_originfull.overflow2=KMINIPHOTOTOP.document.body.style.overflow);KMINIPHOTOTOP.document.documentElement.style.overflow="hidden";KMINIPHOTOTOP.document.documentElement.style.padding="0";KMINIPHOTOTOP.document.documentElement.style.margin="0";KMINIPHOTOTOP.document.documentElement.style.border="0";KMINIPHOTOTOP.document.documentElement.style.height=
"100%";"1"==KMINIPHOTOTOP.G_CURRKMINIPHOTO._config.fullscreenType&&(KMINIPHOTOTOP.document.body.style.overflow="hidden",KMINIPHOTOTOP.document.body.style.padding="0",KMINIPHOTOTOP.document.body.style.margin="0",KMINIPHOTOTOP.document.body.style.border="0",KMINIPHOTOTOP.document.body.style.height="100%");G_originfull.overflow3=a.style.overflow;G_originfull.position3=a.style.position;G_originfull.zIndex=a.style.zIndex;KMINIPHOTOTOP.KMINIPHOTO.util.getClientRect(a);a.style.overflow="hidden";a.style.position=
"absolute";a.style.width="100%";a.style.height="100%";var h=getWindowClientSize(e);a.style.width=h[0]+"px";a.style.height=h[1]+"px";c.style.width=h[0]-2+"px";b.style.width=h[0]-2+"px";b.style.height=h[1]-30-56-20-2+"px";KMINIPHOTOTOP.document.getElementById("kminiphoto_holder_header_"+KMINIPHOTOTOP.G_CURRKMINIPHOTO.ID).style.width=h[0]-2+"px";G_origianPopupPos.push(a.style.left);G_origianPopupPos.push(a.style.top);a.style.left="0px";a.style.top="0px";c=KMINIPHOTOTOP.KMINIPHOTO.util.getClientRect(a);
G_relativePos=isRelativePosition(a);0<c.left||0<c.top?G_isRelativePos=!0:"0"==KMINIPHOTOTOP.G_CURRKMINIPHOTO._config.fullscreenType&&(0<G_originScrollSize[0]&&(a.style.left=G_originScrollSize[0]+"px"),0<G_originScrollSize[1]&&(a.style.top=G_originScrollSize[1]+"px"));"1"==KMINIPHOTOTOP.G_CURRKMINIPHOTO._config.fullscreenType&&adjustPopupPosition();setBackupHiddenStyle(a,e);KMINIPHOTOTOP.KMINIPHOTO.util.addEvent(e,"resize",resizeForFullscreen);KMINIPHOTOTOP.G_CURRKMINIPHOTO.frameStatus="fullscreen";
KMINIPHOTOTOP.document.getElementById("btn_fullscreen_"+KMINIPHOTOTOP.G_CURRKMINIPHOTO.ID).style.backgroundPosition="0 -50px";KMINIPHOTOTOP.document.getElementById("btn_fullscreen_"+KMINIPHOTOTOP.G_CURRKMINIPHOTO.ID).title=KMiniPhoto_Lang.originalScreen;setCanvasPostionCenter()}else fullSreenToOriginalSize()}
function adjustPopupPosition(a){void 0==a&&(a=document.getElementById("miniPhoto_holder"));var c=KMINIPHOTOTOP.document.getElementById("kminiphoto_holder_header_"+KMINIPHOTOTOP.G_CURRKMINIPHOTO.ID);c&&(c=KMINIPHOTOTOP.KMINIPHOTO.util.getClientRect(c),0>c.top&&(a.style.top=KMINIPHOTOTOP.KMINIPHOTO.util.parseIntOr0(a.style.top)-KMINIPHOTOTOP.KMINIPHOTO.util.parseIntOr0(c.top)+"px"))}
function getWindowScrollPos(a){var c=0,b=0;"number"===typeof a.pageYOffset?(c=a.pageXOffset,b=a.pageYOffset):a.document.body&&(a.document.body.scrollLeft||a.document.body.scrollTop)?(c=a.document.body.scrollLeft,b=a.document.body.scrollTop):a.document.documentElement&&(a.document.documentElement.scrollLeft||a.document.documentElement.scrollTop)&&(c=a.document.documentElement.scrollLeft,b=a.document.documentElement.scrollTop);c=changeValueForZoom(c,KMINIPHOTOTOP.G_CURRKMINIPHOTO);b=changeValueForZoom(b,
KMINIPHOTOTOP.G_CURRKMINIPHOTO);return[c,b]}
function getWindowClientSize(a){var c=0,b=0;"number"==typeof a.innerWidth?(c=a.innerWidth,b=a.innerHeight):a.document.documentElement&&(a.document.documentElement.clientWidth||a.document.documentElement.clientHeight)?(c=a.document.documentElement.clientWidth,b=a.document.documentElement.clientHeight):a.document.body&&(a.document.body.clientWidth||a.document.body.clientHeight)&&(c=a.document.body.clientWidth,b=a.document.body.clientHeight);c=changeValueForZoom(c,KMINIPHOTOTOP.G_CURRKMINIPHOTO);b=changeValueForZoom(b,
KMINIPHOTOTOP.G_CURRKMINIPHOTO);return[c,b]}function isRelativePosition(a){for(;null!=a&&(!a.tagName||"body"!=a.tagName.toLowerCase());)if(a=a.parentNode,"relative"==a.style.position)return!0;return!1}
function setBackupHiddenStyle(a,c){G_originStylebackup=[];for(var b=a;null!=b&&(!b.tagName||"body"!=b.tagName.toLowerCase());){if(b!=a){var e;(e=c.getComputedStyle?c.getComputedStyle(b,""):b.currentStyle)&&e.overflow&&"hidden"==e.overflow&&(G_originStylebackup.push(b),b.style.setProperty?b.style.setProperty("overflow","visible",null):b.style.setAttribute("overflow","visible"))}b=b.parentNode}}
function resizeForFullscreen(){var a=KMINIPHOTOTOP.document.getElementById("kminiphoto_holder_"+KMINIPHOTOTOP.G_CURRKMINIPHOTO.ID),c=document.getElementById("miniPhoto_holder"),b=document.getElementById("miniPhoto_image"),e=KMINIPHOTOTOP.G_CURRKMINIPHOTO._config.dialogWindow?KMINIPHOTOTOP.G_CURRKMINIPHOTO._config.dialogWindow:KMINIPHOTOTOP.window,h=KMINIPHOTOTOP.KMINIPHOTO.util.getClientRect(a);a.style.left=KMINIPHOTOTOP.KMINIPHOTO.util.parseIntOr0(a.style.left)+-1*h.left+"px";a.style.top=KMINIPHOTOTOP.KMINIPHOTO.util.parseIntOr0(a.style.top)+
-1*h.top+"px";e=getWindowClientSize(e);a.style.width=e[0]+"px";a.style.height=e[1]+"px";KMINIPHOTOTOP.document.getElementById("kminiphoto_holder_header_"+KMINIPHOTOTOP.G_CURRKMINIPHOTO.ID).style.width=e[0]-2+"px";c.style.width=e[0]-2+"px";c.style.height=e[1]+"px";b.style.width=e[0]-2+"px";b.style.height=e[1]-30-56-20-2+"px";setCanvasPostionCenter()}
function fullSreenToOriginalSize(){var a=KMINIPHOTOTOP.document.getElementById("kminiphoto_holder_"+KMINIPHOTOTOP.G_CURRKMINIPHOTO.ID),c=document.getElementById("miniPhoto_holder"),b=document.getElementById("miniPhoto_image");KMINIPHOTOTOP.KMINIPHOTO.util.removeEvent(KMINIPHOTOTOP.window,"resize",resizeForFullscreen);KMINIPHOTOTOP.document.documentElement.style.margin=G_originfull.margin1;KMINIPHOTOTOP.document.documentElement.style.padding=G_originfull.padding1;KMINIPHOTOTOP.document.documentElement.style.border=
G_originfull.border1;KMINIPHOTOTOP.document.documentElement.style.height=G_originfull.height1;KMINIPHOTOTOP.document.documentElement.style.overflow=G_originfull.overflow1;"1"==KMINIPHOTOTOP.G_CURRKMINIPHOTO._config.fullscreenType&&(KMINIPHOTOTOP.document.body.style.margin=G_originfull.margin2,KMINIPHOTOTOP.document.body.style.padding=G_originfull.padding2,KMINIPHOTOTOP.document.body.style.border=G_originfull.border2,KMINIPHOTOTOP.document.body.style.height=G_originfull.height2,KMINIPHOTOTOP.document.body.style.overflow=
G_originfull.overflow2);a.style.overflow=G_originfull.overflow3;a.style.position=G_originfull.position3;0<G_originPhotoSize.length&&(a.style.width=G_originPhotoSize[0],a.style.height=G_originPhotoSize[1],c.style.width=parseInt(G_originPhotoSize[0],10)-2+"px",KMINIPHOTOTOP.document.getElementById("kminiphoto_holder_header_"+KMINIPHOTOTOP.G_CURRKMINIPHOTO.ID).style.width=parseInt(G_originPhotoSize[0],10)-2+"px",b.style.width=parseInt(G_originPhotoSize[0],10)-2+"px",b.style.height=parseInt(G_originPhotoSize[1],
10)-30-56-20-2+"px",G_originPhotoSize=[]);0<G_origianPopupPos.length&&(a.style.left=G_origianPopupPos[0],a.style.top=G_origianPopupPos[1],G_origianPopupPos=[]);setRestorreHiddenStyle();G_toolHeight=0;null!=G_originScrollSize&&(KMINIPHOTOTOP.window.scroll(G_originScrollSize[0],G_originScrollSize[1]),G_originScrollSize=null);KMINIPHOTOTOP.G_CURRKMINIPHOTO.frameStatus="";KMINIPHOTOTOP.document.getElementById("btn_fullscreen_"+KMINIPHOTOTOP.G_CURRKMINIPHOTO.ID).style.backgroundPosition="0 0";KMINIPHOTOTOP.document.getElementById("btn_fullscreen_"+
KMINIPHOTOTOP.G_CURRKMINIPHOTO.ID).title=KMiniPhoto_Lang.fullScreen;setCanvasPostionCenter()}function setRestorreHiddenStyle(){for(var a=G_originStylebackup.length,c=0;c<a;c++){var b=G_originStylebackup[c];b.style.setProperty?b.style.setProperty("overflow","hidden",null):b.style.setAttribute("overflow","hidden")}G_originStylebackup=[]}
function showPhotoPopup(a){var c=KMINIPHOTOTOP.document.getElementById("kminiphoto_holder_"+KMINIPHOTOTOP.G_CURRKMINIPHOTO.ID);c.parentNode.style.display="";document.getElementById("miniPhoto_holder");document.getElementById("miniPhoto_image");var b=getWindowClientSize(KMINIPHOTOTOP.window),e=getWindowScrollPos(KMINIPHOTOTOP.window),h;if(null==document.getElementById("kminiphoto_popup_background")){h=document.createElement("div");h.setAttribute("id","kminiphoto_popup_background");var r='<div style="'+
KMINIPHOTOTOP.G_CURRKMINIPHOTO._config.popupBackgroundStyle+" z-index:"+(KMINIPHOTOTOP.G_CURRKMINIPHOTO._config.zIndex-1)+'; position:fixed; _position:absolute; left:0px; top:0px;overflow:hidden;width:100%;height:100%;"></div>',r=r+('<iframe frameborder="0" scrolling="no" style="filter:alpha(opacity=0); opacity:0; -moz-opacity:0; -ms-filter:progid:DXImageTransform.Microsoft.Alpha(Opacity=0); -khtml-opacity: 0; left: 0px; top: 0px; width: 100%; height: 100%; display: block; position: absolute; z-index: '+
(KMINIPHOTOTOP.G_CURRKMINIPHOTO._config.zIndex-2)+';"></iframe>');h.innerHTML=r;KMINIPHOTOTOP.document.body.appendChild(h);h.getElementsByTagName("iframe")[0].style.height=b[1]+e[1]+"px"}c.style.display="";c.style.position="absolute";c.style.zIndex=KMINIPHOTOTOP.G_CURRKMINIPHOTO._config.zIndex;h=KMINIPHOTOTOP.KMINIPHOTO.util.getClientRect(c);r=h.bottom-h.top;c.style.left=e[0]+b[0]/2-(h.right-h.left)/2+"px";c.style.top=e[1]+b[1]/2-r/2+"px";adjustPopupPosition();makeDragPopup(c);setImageArea();null!=
a.url&&(KMINIPHOTOTOP.G_CURRKMINIPHOTO.initImgExt=getImageExtensionFromUrl(a.url));loadImage({isInit:!0,src:a.url,width:a.width,height:a.height});KMINIPHOTOTOP.KMINIPHOTO.browser.ie?setTimeout(function(){try{window.focus(),document.focus(),document.body.focus()}catch(a){}},0):setTimeout(function(){try{window.focus(),document.body.focus()}catch(a){}},0)}var G_drag=!1,G_dragPopup;
function makeDragPopup(a){G_drag=!1;var c=a.firstChild;KMINIPHOTOTOP.KMINIPHOTO.util.addEvent(c,"mousedown",startDrag);KMINIPHOTOTOP.KMINIPHOTO.util.addEvent(c,"mouseover",function(){c.style.cursor="move"});KMINIPHOTOTOP.KMINIPHOTO.util.addEvent(c,"mouseout",function(){c.style.cursor="default"});G_dragPopup=a}
function startDrag(a){""==KMINIPHOTOTOP.G_CURRKMINIPHOTO.frameStatus&&(a||(a=KMINIPHOTOTOP.window.event),G_offsetX=a.clientX,G_offsetY=a.clientY,G_dragPopup.style.left||(G_dragPopup.style.left="0px"),G_dragPopup.style.top||(G_dragPopup.style.top="0px"),G_coordX=parseInt(G_dragPopup.style.left),G_coordY=parseInt(G_dragPopup.style.top),G_drag=!0,KMINIPHOTOTOP.document.getElementById("kminiphoto_holder_body_"+KMINIPHOTOTOP.G_CURRKMINIPHOTO.ID).style.display="",KMINIPHOTOTOP.KMINIPHOTO.util.addEvent(KMINIPHOTOTOP.document,
"mousemove",dragDiv),KMINIPHOTOTOP.KMINIPHOTO.util.addEvent(KMINIPHOTOTOP.document,"mouseup",stopDrag));KMINIPHOTOTOP.KMINIPHOTO.util.cancelEvent(a)}
function dragDiv(a){if(G_drag){a||(a=KMINIPHOTOTOP.window.event);var c=getWindowClientSize(KMINIPHOTOTOP.window),b=KMINIPHOTOTOP.KMINIPHOTO.util.getClientRect(G_dragPopup),b=[b.right-b.left||0,b.bottom-b.top||0];currentScrollPos=getWindowScrollPos(KMINIPHOTOTOP.window);var e=G_coordX+a.clientX-G_offsetX,h=G_coordY+a.clientY-G_offsetY;0>=e-currentScrollPos[0]&&(e=currentScrollPos[0]);0>=h-currentScrollPos[1]&&(h=currentScrollPos[1]);e+b[0]>=c[0]+currentScrollPos[0]&&(e=c[0]-b[0]+currentScrollPos[0]);
h+b[1]>=c[1]+currentScrollPos[1]&&(h=c[1]-b[1]+currentScrollPos[1]);G_dragPopup.style.left=e+"px";G_dragPopup.style.top=h+"px";KMINIPHOTOTOP.document.getElementById("kminiphoto_holder_header_"+KMINIPHOTOTOP.G_CURRKMINIPHOTO.ID);adjustPopupPosition(G_dragPopup);KMINIPHOTOTOP.KMINIPHOTO.util.stopEvent(a);KMINIPHOTOTOP.KMINIPHOTO.util.cancelEvent(a)}}
function stopDrag(a){G_drag=!1;G_dragPopup.style.cursor="";KMINIPHOTOTOP.KMINIPHOTO.util.removeEvent(KMINIPHOTOTOP.document,"mousemove",dragDiv);KMINIPHOTOTOP.KMINIPHOTO.util.removeEvent(KMINIPHOTOTOP.document,"mouseup",stopDrag);KMINIPHOTOTOP.document.getElementById("kminiphoto_holder_body_"+KMINIPHOTOTOP.G_CURRKMINIPHOTO.ID).style.display="none"}function selectCropType(a){for(var c=0;6>c;c++)document.getElementById("crop_ratio_"+c).parentNode.style.backgroundColor=a==c?"#b5d0f1":""}
function getImageExtensionFromType(a){var c="png";try{a&&""!=a&&(a=a.split("/")[1]),a&&0<a.length&&(c="gif"==a||"png"==a?"png":"jpeg")}catch(b){c="png"}return c}function getImageExtensionFromUrl(a){var c="";try{if(0==a.indexOf("data:")){var b=a.split(",");2==b.length&&(c=getExtFromImageDataSrc(b[0]))}else var e=a.split("?"),h=e[0].lastIndexOf("."),c=e[0].substring(h+1,e[0].length),c=c.toLowerCase();c="gif"==c||"png"==c?"png":"jpeg"}catch(r){c="png"}return c}
function getExtFromImageDataSrc(a){var c="";a=a.replace("data:","").split(";");0<a.length&&(a=a[0].split("/"),2==a.length&&(c=a[1]));return c}
function getPhotoFromUnloadEvent(a){var c=null;try{if(null!=a){var b=a.target?a.target:a.srcElement;if(b)try{a="",b._raonk_miniphoto?a="kminiphoto_frame_"+b._raonk_miniphoto.ID:b.defaultView&&(a="kminiphoto_frame_"+KMINIPHOTOTOP.G_CURRKMINIPHOTO),c=KMINIPHOTOTOP.KMINIPHOTO.RAONKMULTIPLE[a]}catch(e){c=KMINIPHOTOTOP.G_CURRKMINIPHOTO}else c=KMINIPHOTOTOP.G_CURRKMINIPHOTO}else c=KMINIPHOTOTOP.G_CURRKMINIPHOTO}catch(h){c=KMINIPHOTOTOP.G_CURRKMINIPHOTO}return c}
function fn_makePasteEvt(a){try{if(a&&(KMINIPHOTOTOP.G_CURRKMINIPHOTO=getPhotoFromEvent(a)),KMINIPHOTOTOP.KMINIPHOTO.browser.ie){var c=document.createElement("div");c.id="pasteDiv";c.innerHTML=unescape("%uFEFF");c.style.position="absolute";c.style.filter="alpha(opacity=0)";c.style.overflow="hidden";c.style.left="-1000px";c.style.top="-1000px";c.style.width="0px";c.style.height="0px";c.contentEditable=!0;document.body.appendChild(c);c.focus()}else if(KMINIPHOTOTOP.KMINIPHOTO.browser.gecko){var b=document.createElement("iframe");
b.id="pasteIframe";b.frameBorder=0;b.style.width="0px";b.style.height="0px";b.style.position="absolute";b.style.left="0px";b.style.top="0px";if(KMINIPHOTOTOP.KMINIPHOTO.browser.mobile||KMINIPHOTOTOP.KMINIPHOTO.browser.iOS)b.style.overflow="hidden",b.style.display="inline-block";var e="document.open();"+(KMINIPHOTOTOP.KMINIPHOTO.browser.isCustomDomain(document)?'document.domain="'+document.domain+'";':"")+" document.close();",e=KMINIPHOTOTOP.KMINIPHOTO.browser.ie?"javascript:void(function(){"+encodeURIComponent(e)+
"}())":"";b.src=e;document.body.appendChild(b);var h=KMINIPHOTOTOP.KMINIPHOTO.util.getIframeDocument(b);h.open("text/html","replace");KMINIPHOTOTOP.KMINIPHOTO.browser.isCustomDomain(document)&&(h.domain=document.domain);h.write('<body contenteditable="true">'+unescape("%uFEFF")+"</body>");h.close();h.body.contentEditable=!0;h.body.onpaste=fn_pasteEvt;h.body.focus()}}catch(r){}}
function fn_pasteEvt(a){try{var c=KMINIPHOTOTOP.G_CURRKMINIPHOTO;document.createElement("canvas").getContext("2d");if(KMINIPHOTOTOP.KMINIPHOTO.browser.ie||KMINIPHOTOTOP.KMINIPHOTO.browser.gecko)setTimeout(function(){var a=null,b=null;if(KMINIPHOTOTOP.KMINIPHOTO.browser.ie)b=a=document.getElementById("pasteDiv");else if(KMINIPHOTOTOP.KMINIPHOTO.browser.gecko)try{var e=document.getElementById("pasteIframe");e&&(a=KMINIPHOTOTOP.KMINIPHOTO.util.getIframeDocument(e).body,b=e)}catch(h){a=null}a&&(a.blur(),
a=a.getElementsByTagName("img"),0<a.length&&(c.initImgExt="png",loadImage({isInit:!1,isOpen:!0,src:a[0].src})),b.parentNode.removeChild(b))},0);else if(KMINIPHOTOTOP.KMINIPHOTO.browser.chrome||KMINIPHOTOTOP.KMINIPHOTO.browser.opera){var b=a.clipboardData.items,e=b.length;for(a=0;a<e;++a){var h=b[a].getAsFile(),r=new FileReader;r.onload=function(a){a=a.target.result;c.initImgExt="png";loadImage({isInit:!1,isOpen:!0,src:a});r=void 0};r.readAsDataURL(h)}}}catch(t){}}
function getPhotoFromEvent(a){var c=null;try{if(null!=a){var b=a.target?a.target:a.srcElement;if(b){a=null;a=9!=b.nodeType?b.ownerDocument:b;try{a=a.defaultView?a.defaultView:a.parentWindow,c=KMINIPHOTOTOP.KMINIPHOTO.RAONKMULTIPLE[a.frameElement.id]}catch(e){c=KMINIPHOTOTOP.G_CURRKMINIPHOTO}}else c=KMINIPHOTOTOP.G_CURRKMINIPHOTO}else c=KMINIPHOTOTOP.G_CURRKMINIPHOTO}catch(h){c=KMINIPHOTOTOP.G_CURRKMINIPHOTO}return c}function documentDragOver(a){KMINIPHOTOTOP.KMINIPHOTO.util.cancelEvent(a)}
function insertDropImage(a){var c=a.dataTransfer.files;a.stopPropagation();a.preventDefault();if(0<c.length&&c[0].type&&0==c[0].type.indexOf("image")){var b=getImageExtensionFromType(c[0].type),e=new FileReader;e.onload=function(a){a=a.target.result;"data:"==a.substring(0,5)&&2==a.split(",").length&&(KMINIPHOTOTOP.G_CURRKMINIPHOTO.initImgExt=b,loadImage({isInit:!1,isOpen:!0,src:a}));e=void 0};e.readAsDataURL(c[0])}}
function getKMINIPHOTOWINoomValue(a){var c=1;try{if("1"==a._config.autoSetZoom.use){var b=KMINIPHOTOTOP.KMINIPHOTOWIN.document.body;a._config.autoSetZoom&&null!=a._config.autoSetZoom.checkNode&&(b=a._config.autoSetZoom.checkNode);var e=KMINIPHOTOTOP.KMINIPHOTOWIN.getComputedStyle(b,null).zoom;void 0!=e&&(c=e)}}catch(h){}return c}function setZoomValueToBody(a,c){if("1"==c._config.autoSetZoom.use)try{var b=getKMINIPHOTOWINoomValue(c);a.body.style.zoom=b}catch(e){}}
function changeValueForZoom(a,c){var b=a;if("1"==c._config.autoSetZoom.use)var e=getKMINIPHOTOWINoomValue(c),b=b/e;return b};var G_HISTORY={redo_list:[],undo_list:[],saveState:function(a,c,b,e){b||(this.redo_list=[]);e?(c||this.undo_list).push(e.src):(a=a.toDataURL("image/"+KMINIPHOTOTOP.G_CURRKMINIPHOTO.initImgExt,1),(c||this.undo_list).push(a));this.displayBtn()},undo:function(a,c){this.restoreState(a,c,this.undo_list,this.redo_list)},redo:function(a,c){this.restoreState(a,c,this.redo_list,this.undo_list)},restoreState:function(a,c,b,e){var h=this;b.length&&(displayProcessing(!0),setTimeout(function(){h.saveState(a,e,
!0);var c=b.pop(),t=new Image;t.onload=function(){document.getElementById("miniPhoto_image");var b=a.getContext("2d");b.setTransform(1,0,0,1,0,0);b.clearRect(0,0,a.width,a.height);KMINIPHOTOTOP.G_CURRKMINIPHOTO.currDegree=0;KMINIPHOTOTOP.G_CURRKMINIPHOTO.flipX=!1;KMINIPHOTOTOP.G_CURRKMINIPHOTO.flipY=!1;KMINIPHOTOTOP.G_CURRKMINIPHOTO.currImage=t;a.width=t.naturalWidth;a.height=t.naturalHeight;a.parentNode.style.width=t.naturalWidth+"px";a.parentNode.style.height=t.naturalHeight+"px";b.drawImage(t,
0,0);t.style.display="none";setCanvasPostionCenter();displayProcessing(!1);try{t=void 0}catch(c){}};t.src=c;h.displayBtn()},50))},reset:function(){this.redo_list=[];this.undo_list=[];this.displayBtn()},displayBtn:function(){document.getElementById("btn_redo").firstChild.className=0<this.redo_list.length?"redo":"redo deact-r";document.getElementById("btn_undo").firstChild.className=0<this.undo_list.length?"undo":"undo deact-u"}};
